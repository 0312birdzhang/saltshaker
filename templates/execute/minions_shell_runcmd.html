{% extends "base.html" %}
  {% block content %}
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-header">Run Shell Command</h2>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Run Shell Command
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="dataTable_wrapper">
                                     <label><a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">Target</a></label>
                                  <div>
                                     <div id="collapseOne" class="panel-collapse collapse in">
                                        <div class="panel-body" style="padding:0px">
                                           <table class="table table-striped table-bordered table-hover">
                                               <tr>
                                                   <td>
                                                       <label>Groups</label>
                                                   </td>
                                                   <td>
                                                       <label>Hosts</label>
                                                   </td>
                                               </tr>
                                               {% for groups,hosts in list_groups.items %}
                                               <tr>
                                                   <td>
                                                       <div class="checkbox-inline" style="margin-left:7px">
                                                          <input  id="{{ groups }}"  onclick="selectAll('{{ groups }}')" type="checkbox" value="">{{ groups }}
                                                       </div>
                                                   </td>
                                                   <td>
                                                       {% for host in hosts %}
                                                           <div class="checkbox-inline" name="checkedhost">
                                                               <input class="checkedhost" name="{{ groups }}"  onclick="selectAll()" type="checkbox" value="{{ host }}" >{{ host }}
                                                           </div>
                                                       {% endfor %}
                                                   </td>
                                               </tr>
                                               {% endfor %}
                                           </table>
                                        </div>
                                    </div>
                                </div>
                              </div>
                            <div class="form-group">
                                <label>Command</label>
                                <textarea class="form-control" rows="3" name="cmd" id="shell_cmd"></textarea>
                            </div>
                            <div class="form-group">
                                <input type="button" value="Submit" class="btn btn-default" onclick="shellResult()" />
                                <input type="button" value="Submit" class="btn btn-default" onclick="iframepage.window.location.reload()" />
                                <input type="reset" value="Reset" class="btn btn-default" />
                            </div>
                            <div class="form-group">
                                <label>Command Result</label>
                                <iframe src="../execute/minions_shell_result.html" frameborder="0" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" width="100%" height=100% id="iframepage" onLoad="iFrameHeight()"></iframe>
                            </div>
                         </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
        </div>

    <script type="text/javascript">

        function selectAll(group){
           var checklist = document.getElementsByName(group);
            //alert(checklist)
           if(document.getElementById(group).checked)
               {
                   for(var i=0;i<checklist.length;i++)
                      {
                         checklist[i].checked = 1;
                      }
               }
           else
               {
                   for(var j=0;j<checklist.length;j++)
                     {
                        checklist[j].checked = 0;
                     }
               }
        }

        function iFrameHeight() {
           var ifm= document.getElementById("iframepage");
           var subWeb = document.frames ? document.frames["iframepage"].document :
              ifm.contentDocument;
              if(ifm != null && subWeb != null) {
              ifm.height = subWeb.body.scrollHeight;
              }
        }

        function shellResult() {
            var ahost = document.getElementsByClassName("checkedhost");
            var acmd = document.getElementById("shell_cmd").value.replace(/(^\s*)|(\s*$)/g, "");
            var iframe = document.getElementById("iframepage");
            var hostlist = new Array();
            for(var i = 0; i < ahost.length; i++){
                if(ahost[i].checked)
                    hostlist.push(ahost[i].value);
            }
            //alert(hostlist);
            //alert(acmd);
            $.post("../execute/minions_shell_result", { cmd: acmd , hosts_name: hostlist } );
            $.get("../execute/minions_shell_result")
            //$.post("../groups/del_host", { groups_name: group , hosts_name: host } );
            //window.parent.frames[1].location.reload();
            //window.location.reload()
            //$('#iframe').attr('src', $('#iframe').attr('src'));
            //document.getElementById('iframepage').contentWindow.location.reload(true);
        }
    </script>

{% endblock %}
