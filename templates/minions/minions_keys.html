{% extends "base.html" %}
  {% block content %}
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="page-header">Minions Key Manage</h2>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Minions Key Manage
                             <!-- begin action -->
                             <div class="btn-group" style="float:right">
                               <button type="button" class="btn btn-outline btn-success btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                               Action <span class="caret"></span>
                               </button>
                               <ul class="dropdown-menu">
                                 <li><a id="accept_minion_key" href="#"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> | Accept Key </a></li>
                                 <li role="separator" class="divider"></li>
                                 <li><a id="reject_minion_key" href="#"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> | Reject Key </a></li>
                                 <li role="separator" class="divider"></li>
                                 <li><a id="delete_minion_key" href="#"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span> | Delete Key </a></li>
                               </ul>
                             </div>
                             <!-- end action -->
                               <!-- begin modal  -->
                               <!-- accept modal -->
                               <div id="accept_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                                 <div class="modal-dialog modal-lg">
                                   <div class="modal-content">
                                     <div class="modal-header">
                                       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                       <h4 class="modal-title" id="exampleModalLabel">Accept Minions Key</h4>
                                     </div>
                                     <div class="modal-body">
                                       <form id="accept_data" class="form-inline" method="POST" action="/minions/minions_keys/">
                                       <!-- jquery will append content here -->
                                       </form>
                                     </div>
                                     <div class="modal-footer">
                                       <button type="button" class="btn btn-outline btn-warning btn-xs" data-dismiss="modal">Close</button>
                                       <button id="accept_commit" type="button" class="btn btn-outline btn-danger btn-xs" data-dismiss="modal" >Accept</button>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                               <!-- accept delete -->

                               <!-- delete modal -->
                               <div id="delete_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                                 <div class="modal-dialog modal-lg">
                                   <div class="modal-content">
                                     <div class="modal-header">
                                       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                       <h4 class="modal-title" id="exampleModalLabel">Delete Minions Key</h4>
                                     </div>
                                     <div class="modal-body">
                                       <form id="delete_data" class="form-inline" method="POST" action="/minions/minions_keys/">
                                       <!-- jquery will append content here -->
                                       </form>
                                     </div>
                                     <div class="modal-footer">
                                       <button type="button" class="btn btn-outline btn-warning btn-xs" data-dismiss="modal">Close</button>
                                       <button id="delete_commit" type="button" class="btn btn-outline btn-danger btn-xs" data-dismiss="modal" >Delete</button>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                               <!-- end delete -->

                               <!-- reject modal -->
                               <div id="reject_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                                 <div class="modal-dialog modal-lg">
                                   <div class="modal-content">
                                     <div class="modal-header">
                                       <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                       <h4 class="modal-title" id="exampleModalLabel">Reject Minions Key</h4>
                                     </div>
                                     <div class="modal-body">
                                       <form id="reject_data" class="form-inline" method="POST" action="/minions/minions_keys/">
                                       <!-- jquery will append content here -->
                                       </form>
                                     </div>
                                     <div class="modal-footer">
                                       <button type="button" class="btn btn-outline btn-warning btn-xs" data-dismiss="modal">Close</button>
                                       <button id="reject_commit" type="button" class="btn btn-outline btn-danger btn-xs" data-dismiss="modal" >Reject</button>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                               <!-- reject delete -->

                               <!-- checkbox error modal -->
                               <div id="checkbox_error_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                                 <div class="modal-dialog modal-lg">
                                   <div class="modal-content">
                                     <div class="modal-content">
                                       <div class="modal-header">
                                         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                       </div>
                                       <div class="modal-body">
                                         <h4 class="modal-title" id="checkbox_error">There is no item selected</h4>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                               <!-- end checkbox error modal-->

                               <!-- alert error modal -->
                               {% if error %}
                               <div id="error_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                                 <div class="modal-dialog modal-lg">
                                   <div class="modal-content">
                                     <div class="modal-content">
                                       <div class="modal-header">
                                         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                       </div>
                                       <div class="modal-body">
                                         <h4 class="modal-title" id="error">{{ error }}</h4>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                               {% endif %}
                               <!-- end alert error modal  -->

                               <!-- alert success modal -->
                               {% if success %}
                               <div id="success_modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                                 <div class="modal-dialog modal-lg">
                                   <div class="modal-content">
                                     <div class="modal-content">
                                       <div class="modal-header">
                                         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                       </div>
                                       <div class="modal-body">
                                         <h4 id="success" class="modal-title">{{ success }}</h4>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                               {% endif %}
                               <!-- end alert success modal  -->
                                </div>
                        <div class="panel-body">
                            <div class="dataTable_wrapper">
                                <form method="post" action="/minions/minions_keys/">
                                <table class="table table-striped table-bordered table-hover" id="datatable-demo">
                                    <thead>
                                        <tr>
                                            <th>
                                                <input id="CHKall" type="checkbox" name="CHKall" value="CHKall"></input>
                                            </th>
                                            <th>Minions</th>
                                            <th>Keys Status</th>
                                            <th>Accept Key</th>
                                            <th>Reject Key</th>
                                            <th>Delete Key</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for hostname in key.minions_pre %}
                                        <tr class="even gradeC">
                                            <td>
                                                <input  name="CHKlist" type="checkbox" value="{{ hostname }}"></input>
                                            </td>
                                            <td>{{ hostname }}</td>
                                            <td>Unaccepted</td>
                                            <td><button type="submit" class="btn btn-success btn-xs" value="{{ hostname }}" name="accept">Accept Key</button></td>
                                            <td><button type="submit" class="btn btn-warning btn-xs" value="{{ hostname }}" name="reject">Reject Key</button></td>
                                            <td><button type="submit" class="btn btn-danger btn-xs" value="{{ hostname }}" name="delete">Delete Key</button></td>
                                        </tr>
                                        {% endfor %}
                                        {% for hostname in key.minions_denied %}
                                        <tr class="odd gradeA">
                                            <td>
                                                <input  name="CHKlist" type="checkbox" value="{{ hostname }}"></input>
                                            </td>
                                            <td>{{ hostname }}</td>
                                            <td>Denied</td>
                                            <td><button type="submit" class="btn btn-success btn-xs disabled" value="{{ hostname }}" name="accept">Accept Key</button></td>
                                            <td><button type="submit" class="btn btn-warning btn-xs disabled" value="{{ hostname }}" name="reject">Reject Key</button></td>
                                            <td><button type="submit" class="btn btn-danger btn-xs" value="{{ hostname }}" name="delete">Delete Key</button></td>
                                        </tr>
                                        {% endfor %}
                                        {% for hostname in key.minions_rejected %}
                                        <tr class="even gradeA">
                                            <td>
                                                <input  name="CHKlist" type="checkbox" value="{{ hostname }}"></input>
                                            </td>
                                            <td>{{ hostname }}</td>
                                            <td>Rejected</td>
                                            <td><button type="submit" class="btn btn-success btn-xs disabled" value="{{ hostname }}" name="accept">Accept Key</button></td>
                                            <td><button type="submit" class="btn btn-warning btn-xs disabled" value="{{ hostname }}" name="reject">Reject Key</button></td>
                                            <td><button type="submit" class="btn btn-danger btn-xs" value="{{ hostname }}" name="delete">Delete Key</button></td>
                                        </tr>
                                        {% endfor %}
                                        {% for hostname in key.minions %}
                                        <tr class="odd gradeX">
                                            <td>
                                                <input  name="CHKlist" type="checkbox" value="{{ hostname }}"></input>
                                            </td>
                                            <td>{{ hostname }}</td>
                                            <td>Accepted</td>
                                            <td><button type="button" class="btn btn-success btn-xs disabled" value="Accept Key">Accept Key</button></td>
                                            <td><button type="submit" class="btn btn-warning btn-xs disabled" value="{{ hostname }}" name="reject">Reject Key</button></td>
                                            <td><button type="submit" class="btn btn-danger btn-xs" value="{{ hostname }}" name="delete">Delete Key</button></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                </form>
                            </div>
                            <!-- /.table-responsive -->                  
                        </div>
                        <!-- /.panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->
  {% endblock %}
    {% block jquery%}
    <script type="text/javascript">
      $(document).ready(function(){
        //全选或全不选
        $("#CHKall").click(function(){
            if(this.checked){
                $("input[name='CHKlist']").prop("checked", true);
            }else{
                $("input[name='CHKlist']").prop("checked", false);
            }
         });
        // end slelect all

         //data table
         $("#datatable-demo").DataTable( {
            //设置第一列为初始化排序的列
            "order": [[ 3, "desc" ]],
            });
         // end data table
        // add //
        $("#accept_minion_key").click(function(){
            var ids=[];
           $('input[name="CHKlist"]:checked').each(function(){
               var id=$(this).val();
               //tr_index = $(this).parent().parent().index()
               //td_name = $(this).parent().parent().children("td:eq(2)").text()
               ids.push(id);
           });
           if (ids.length >0)
               {
               $("#accept_data").empty()
               for (i in ids){
                   $("#accept_data").append(
                       '<div class="form-group"><label class="control-label">Minions:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input readonly name="accept" value="'+ ids[i] +'" type="text" class="form-control"></input></div> <br>'
                       );
                   };
                 $('#accept_modal').modal('show')
               }
             else
                {
                   $('#checkbox_error_modal').modal('show')
                }
           $("#accept_commit").click(function(){
                 $("#accept_data").submit()
             });
        });
        // end accept //

        // delete //
        $("#delete_minion_key").click(function(){
           var ids=[];
           $('input[name="CHKlist"]:checked').each(function(){
               var id=$(this).val();
               //tr_index = $(this).parent().parent().index()
               //td_name = $(this).parent().parent().children("td:eq(2)").text()
               ids.push(id);
           });
           if (ids.length >0)
               {
               $("#delete_data").empty()
               for (i in ids){
                   $("#delete_data").append(
                       '<div class="form-group"><label class="control-label">Minions:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input readonly name="delete" value="'+ ids[i] +'" type="text" class="form-control"></input></div> <br>'
                       );
                   };
                 $('#delete_modal').modal('show')
               }
             else
                {
                   $('#checkbox_error_modal').modal('show')
                }
           $("#delete_commit").click(function(){
                 $("#delete_data").submit()
             });
      });
      // end delete //
      // reject //
      $("#reject_minion_key").click(function(){
          var ids=[];
           $('input[name="CHKlist"]:checked').each(function(){
               var id=$(this).val();
               //tr_index = $(this).parent().parent().index()
               //td_name = $(this).parent().parent().children("td:eq(2)").text()
               ids.push(id);
           });
           if (ids.length >0)
               {
               $("#reject_data").empty()
               for (i in ids){
                   $("#reject_data").append(
                       '<div class="form-group"><label class="control-label">Minions:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input readonly name="reject" value="'+ ids[i] +'" type="text" class="form-control"></input></div> <br>'
                       );
                   };
                 $('#reject_modal').modal('show')
               }
             else
                {
                   $('#checkbox_error_modal').modal('show')
                }
           $("#reject_commit").click(function(){
                 $("#reject_data").submit()
             });
      });
      // end reject //

      //show success and error modal //
      $('#success_modal').modal('show')
      $('#error_modal').modal('show')
      //  end show success and error modal //
    });
    </script>
    {% endblock %}